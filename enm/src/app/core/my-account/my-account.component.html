<div class="back-arrow">
  <p-button type="button" (click)="goBack()" icon="pi pi-arrow-left" styleClass="p-button-rounded p-button-lg p-button-text"></p-button>
</div>

<div *ngIf="currentUser$"></div>

<ng-container *ngIf="(currentUser$ | async) as currentUser">
  <!-- Content to display if the username is a founding account -->
  <div class="d-flex justify-content-center align-items-center" style="margin-top: 20px">
    <div class="container">
      <div class="row">
        <div class="col">
          <div *ngIf="founderAccounts.includes(currentUser.username); else notFoundingAccount">
            <h2 style="color: #708da8; margin-left: 15px;">Account</h2>
              <p-panel header="General">
                <div *ngIf="(currentUser$ | async) as currentUser">
                  <p><b>Username:</b> {{ currentUser.username }}</p>
                  <p><b>Account Type:</b><span> Founder</span></p>
                  <p>Founders are among the first people to ever use Rarelygroovy. You will forever have access to the latest and greatest features we have to offer. Thank you for seeing our vision so early on in our journey! </p>
                </div>
              </p-panel>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content to display if the username is NOT a founding account -->
  <ng-template #notFoundingAccount>
    <div *ngIf="isUpcomingSubscriptionRenewalDateLoading$ | async" class="d-flex justify-content-center align-items-center" style="height: 65vh;">
      <p-progressSpinner styleClass= "w-4rem h-4rem" strokeWidth="2" fill="var(--surface-ground)" class="custom-spinner"></p-progressSpinner>
    </div>
    
    <div *ngIf="!(isUpcomingSubscriptionRenewalDateLoading$ | async)" class="d-flex justify-content-center align-items-center" style="height: 65vh;">
      <div class="d-flex justify-content-center align-items-center" style="margin-top: 20px">
        <div class="container">
          <div class="row">
            <div class="col">
              <h2 style="color: #708da8; margin-left: 15px;">Account</h2>
              <p-panel header="General">
                <div *ngIf="(currentUser$ | async) as currentUser">
                  <p><b>Username:</b> {{ currentUser.username }}</p>
                  <p><b>Account Type:</b><span *ngIf="(nextInvoice$ | async)"> Rarelygroovy+</span><span *ngIf="!(nextInvoice$ | async)"> Free</span></p>
                </div>
    
              </p-panel>
            </div>
          </div>
          <div class="row" style="margin-top: 10px;">
            <div class="col">
              <p-panel header="Rarelygroovy+">
                <div *ngIf="((subscriptionStatus$ | async) === 'active')">
                  <div *ngIf="(nextInvoice$ | async) as nextInvoice">
                    <p *ngIf="nextInvoice"><b>Subscription Renews:</b> {{ nextInvoice | date: 'medium' }}</p>
                    <p *ngIf="!nextInvoice">No upcoming invoice found.</p>
                    <p-button class="primebutton" size="small" (click)="cancelSubscription()" label="Cancel Subscription" [disabled]="(( isSubscriptionCanceling$ | async) === true)">
                      <div *ngIf="isSubscriptionCanceling$ | async">
                        <p-progressSpinner strokeWidth="2" fill="var(--surface-ground)" class="custom-spinner" [style]="{width: '20px', height: '12px', margin: '0px 20px 0px 0px'}"></p-progressSpinner>
                      </div>
                    </p-button>
                  </div>
                </div>
                <div *ngIf="((subscriptionStatus$ | async) === 'canceled')">
                  <p><b>Subscription Cancelled On:</b> {{ (subscriptionCancellationDate$ | async) | date }}</p>
                  <p-button size="small" label="Renew Subscription" (click)="renewSubscription()"></p-button>
                </div>
                <div *ngIf="!((subscriptionStatus$ | async))">
                  <p>No subscription information available.</p>
                  <p>When you subscribe to <a routerLink="/plus">Rarelygroovy+</a>, you'll see details about your subscription here</p>
                </div>
              </p-panel>
            </div>
          </div>
        </div>
    
    
    
      </div>
    </div>
  </ng-template>
</ng-container>


